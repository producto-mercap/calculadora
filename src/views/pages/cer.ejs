<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <%- include('../partials/header') %>
    
    <div class="app-container">
        <main class="main-content">
            <div class="content-area">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h1 class="page-title" style="margin: 0;">Valores CER</h1>
                    
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <label style="font-size: 14px; color: var(--text-secondary);">Desde:</label>
                            <div style="position: relative; display: inline-block;">
                                <input type="text" class="input date-input" id="fechaDesdeCER" style="width: 150px; padding-right: 40px;" placeholder="DD/MM/AAAA" maxlength="10" />
                                <button type="button" class="date-picker-icon" onclick="abrirDatePicker('fechaDesdeCER')" title="Seleccionar fecha">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                                    </svg>
                                </button>
                                <div id="datePickerDesdeCER" class="date-picker-popup" style="display: none;"></div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <label style="font-size: 14px; color: var(--text-secondary);">Hasta:</label>
                            <div style="position: relative; display: inline-block;">
                                <input type="text" class="input date-input" id="fechaHastaCER" style="width: 150px; padding-right: 40px;" placeholder="DD/MM/AAAA" maxlength="10" />
                                <button type="button" class="date-picker-icon" onclick="abrirDatePicker('fechaHastaCER')" title="Seleccionar fecha">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                                    </svg>
                                </button>
                                <div id="datePickerHastaCER" class="date-picker-popup" style="display: none;"></div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="cargarCER().catch(console.error)" id="btnCargarCER">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            <span>Cargar CER</span>
                        </button>
                    </div>
                </div>
                
                <div class="card" id="cardCER">
                    <% if (datos && datos.length > 0) { %>
                        <div id="cerTableContainer">
                            <div style="overflow-x: auto;">
                                <table class="cashflow-table" id="cerTable">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Valor CER</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cerTableBody">
                                        <% 
                                        function formatearFechaEJS(fecha) {
                                            if (!fecha) return '';
                                            // Si es un objeto Date
                                            if (fecha instanceof Date) {
                                                const day = String(fecha.getDate()).padStart(2, '0');
                                                const month = String(fecha.getMonth() + 1).padStart(2, '0');
                                                const year = fecha.getFullYear();
                                                return `${day}/${month}/${year}`;
                                            }
                                            // Si es un string en formato YYYY-MM-DD
                                            if (typeof fecha === 'string' && /^\d{4}-\d{2}-\d{2}/.test(fecha)) {
                                                const partes = fecha.split('T')[0].split('-');
                                                return `${partes[2]}/${partes[1]}/${partes[0]}`;
                                            }
                                            return fecha;
                                        }
                                        %>
                                        <% datos.forEach(item => { %>
                                            <tr>
                                                <td><%= formatearFechaEJS(item.fecha) %></td>
                                                <td><%= typeof item.valor === 'number' ? item.valor.toFixed(4) : item.valor %></td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Controles de paginaciÃ³n -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border-color);">
                                <div style="font-size: 14px; color: var(--text-secondary);">
                                    Mostrando <%= ((pagina - 1) * porPagina) + 1 %> - <%= Math.min(pagina * porPagina, total) %> de <%= total %> registros
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <button class="btn" onclick="cambiarPaginaCER(<%= pagina - 1 %>)" <%= pagina <= 1 ? 'disabled' : '' %> style="<%= pagina <= 1 ? 'opacity: 0.5; cursor: not-allowed;' : '' %>">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                                        </svg>
                                        <span>Anterior</span>
                                    </button>
                                    <div style="font-size: 14px; color: var(--text-primary); padding: 0 16px;">
                                        PÃ¡gina <%= pagina %> de <%= totalPaginas || 1 %>
                                    </div>
                                    <button class="btn" onclick="cambiarPaginaCER(<%= pagina + 1 %>)" <%= pagina >= (totalPaginas || 1) ? 'disabled' : '' %> style="<%= pagina >= (totalPaginas || 1) ? 'opacity: 0.5; cursor: not-allowed;' : '' %>">
                                        <span>Siguiente</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="cerEmptyState" class="empty-state" style="display: none;">
                            <div class="empty-state-icon">ðŸ“Š</div>
                            <div class="empty-state-text">Datos de CER desde BCRA</div>
                            <div class="empty-state-subtext">Seleccione un rango de fechas y haga clic en "Cargar CER" para obtener los datos</div>
                        </div>
                    <% } else { %>
                        <div id="cerEmptyState" class="empty-state">
                            <div class="empty-state-icon">ðŸ“Š</div>
                            <div class="empty-state-text">Datos de CER desde BCRA</div>
                            <div class="empty-state-subtext">No hay datos de CER en la base de datos. Seleccione un rango de fechas y haga clic en "Cargar CER" para obtener los datos</div>
                        </div>
                        <div id="cerTableContainer" style="display: none;">
                            <div style="overflow-x: auto;">
                                <table class="cashflow-table" id="cerTable">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Valor CER</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cerTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    <% } %>
                </div>
                
                <script>
                    // Variables globales para paginaciÃ³n
                    window.cerPaginaActual = <%= pagina || 1 %>;
                    window.cerTotalPaginas = <%= totalPaginas || 1 %>;
                    window.cerTotal = <%= total || 0 %>;
                    window.cerPorPagina = <%= porPagina || 50 %>;
                </script>
            </div>
        </main>
    </div>

    <script src="/js/main.js"></script>
    <script src="/js/cer.js"></script>
</body>
</html>
